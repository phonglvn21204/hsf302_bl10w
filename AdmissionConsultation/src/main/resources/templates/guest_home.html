<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>Trang tÆ° váº¥n tuyá»ƒn sinh</title>
	<link rel="stylesheet" th:href="@{/css/guest_home.css}">
	<link rel="stylesheet" th:href="@{/css/chatbot.css}">
	<script th:src="@{/js/chatbot.js}" defer></script>
</head>
<body>
<div class="top-bar">
	<h1>TÆ° váº¥n tuyá»ƒn sinh</h1>
	<p>VÃ¬ má»™t tÆ°Æ¡ng lai tÆ°Æ¡i sÃ¡ng cá»§a tháº¿ há»‡ tráº»</p>

	<div th:if="${session.currentUser != null}">
		<span th:text="'ğŸ‘‹ Xin chÃ o, ' + ${session.currentUser.fullName}"></span> |
		<a th:href="@{/logout}">ğŸ”“ ÄÄƒng xuáº¥t</a>
	</div>
	<div th:unless="${session.currentUser != null}">
		<a th:href="@{/login}">ğŸ” ÄÄƒng nháº­p</a>
	</div>
</div>


<div class="blog-list">
	<div class="blog-item" th:each="blog : ${blogs}">
		<img th:src="@{${blog.imageUrl}}" alt="áº¢nh blog"/>
		<h3 th:text="${blog.title}"></h3>
		<p th:text="${#strings.abbreviate(blog.content, 100)}"></p>
		<a th:href="@{'/blogs/' + ${blog.id}}">Xem chi tiáº¿t</a>
	</div>
</div>

<div class="appointment-form">
	<h2>ğŸ“† Gá»­i yÃªu cáº§u tÆ° váº¥n tuyá»ƒn sinh</h2>
	<div th:if="${loginMessage}" class="alert-login">
		<p th:text="${loginMessage}"></p>
		<a th:href="@{/login}" class="btn-login">ğŸ‘‰ ÄÄƒng nháº­p ngay</a>
	</div>

	<form th:action="@{/appointments/submit}" method="post">
		<label for="school">TrÆ°á»ng Ä‘áº¡i há»c:</label>
		<select id="school" name="schoolId" required>
			<option th:each="school : ${schools}" th:value="${school.id}" th:text="${school.name}"></option>
		</select>

		<label for="major">NgÃ nh há»c:</label>
		<select id="major" name="majorId" required>
			<option value="">-- Chá»n ngÃ nh --</option>
		</select>
		<button type="submit">Gá»­i yÃªu cáº§u</button>
	</form>
	<a href="/scholarships/finder" class="btn btn-info">
		<i class="fas fa-graduation-cap"></i> TÃ¬m há»c bá»•ng
	</a>
</div>
<div th:replace="~{fragments/chatbot :: chatbot}"></div>
<script th:inline="javascript">
    /*<![CDATA[*/
    document.addEventListener("DOMContentLoaded", function () {
        const schoolSelect = document.getElementById("school");
        const majorSelect = document.getElementById("major");

        function loadMajors(schoolId) {
            fetch('/majors/by-school/' + schoolId)
                .then(response => response.json())
                .then(data => {
                    majorSelect.innerHTML = "";
                    data.forEach(major => {
                        const option = document.createElement("option");
                        option.value = major.id;
                        option.textContent = major.name;
                        majorSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error("Lá»—i khi táº£i majors:", error);
                    majorSelect.innerHTML = `<option value="">KhÃ´ng thá»ƒ táº£i ngÃ nh</option>`;
                });
        }

        schoolSelect.addEventListener("change", function () {
            const selectedSchoolId = this.value;
            loadMajors(selectedSchoolId);
        });

        if (schoolSelect.value) {
            loadMajors(schoolSelect.value);
        }
    });
</script>

</body>
</html>
